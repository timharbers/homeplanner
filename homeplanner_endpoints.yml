---
openapi: 3.0.3
info:
  title: Household API
  description: API for managing households and household membership.
  version: 1.0.0
servers:
  - url: https://api.example.com
security:
  - BearerAuth: []
paths:
  /household:
    get:
      operationId: getHousehold
      summary: Get household information
      description: Fetch household details for the current user.
      tags:
        - Household
      responses:
        "200":
          description: Household details retrieved successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Household"
        "401":
          description: Unauthorized
    post:
      operationId: createHousehold
      summary: Create household
      description: Create a new household. The authenticated user becomes the owner.
      tags:
        - Household
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateHouseholdRequest"
      responses:
        "201":
          description: Household created successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Household"
        "400":
          description: User is already part of a household
        "401":
          description: Unauthorized         
    put:
      operationId: updateHousehold
      summary: Update household
      description: Update the household name. Owner only.
      tags:
        - Household
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateHouseholdRequest"
      responses:
        "200":
          description: Household updated successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Household"
        "401":
          description: Unauthorized
        "403":
          description: Forbidden – user is not the household owner
    delete:
      operationId: deleteHousehold
      summary: Delete household
      description: Permanently delete the household and all associated data. Owner only.
      tags:
        - Household
      responses:
        "204":
          description: Household deleted successfully
        "401":
          description: Unauthorized
        "403":
          description: Forbidden – user is not the household owner
  /household/leave:
    post:
      operationId: leaveHousehold
      summary: Leave household
      description: Current user leaves the household.
      tags:
        - Household
      responses:
        "204":
          description: User left the household successfully
        "400":
          description: Owner cannot leave the household
        "401":
          description: Unauthorized
  /household/users/{user_id}:
    delete:
      operationId: removeHouseholdMember
      summary: Remove household member
      description: |
        Remove a user from the household.
        Allowed for household owner or the user removing themselves.
      tags:
        - Household
      parameters:
        - name: user_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "204":
          description: User removed from household
        "401":
          description: Unauthorized
        "403":
          description: Forbidden – insufficient permissions
        "404":
          description: User not found in household
  /rooms:
    get:
      operationId: getRooms
      summary: Get household rooms
      description: Fetch list of rooms in the household for task filtering, including color coding.
      tags:
        - Rooms
      responses:
        "200":
          description: List of rooms
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Room"
        "401":
          description: Unauthorized

    post:
      operationId: createNewRoom
      summary: Create new room
      description: Quick create a new room from within the task form.
      tags:
        - Rooms
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateRoomRequest"
      responses:
        "201":
          description: Room created successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Room"
        "401":
          description: Unauthorized

  /rooms/{room_id}:
    get:
      operationId: getSingleRoom
      summary: Get single room details
      description: Fetch detailed information for a specific room including metadata and aggregated task statistics.
      tags:
        - Rooms
      parameters:
        - name: room_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Room details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RoomDetails"
        "404":
          description: Room not found
        "401":
          description: Unauthorized

    put:
      operationId: updateRoom
      summary: Update room
      description: Update room details including name, color, and floor.
      tags:
        - Rooms
      parameters:
        - name: room_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateRoomRequest"
      responses:
        "200":
          description: Room updated successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Room"
        "404":
          description: Room not found
        "401":
          description: Unauthorized

    delete:
      operationId: deleteRoom
      summary: Delete room
      description: |
        Delete a room. Only allowed if no tasks are assigned,
        or tasks must be reassigned before deletion.
      tags:
        - Rooms
      parameters:
        - name: room_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "204":
          description: Room deleted successfully
        "409":
          description: Room has assigned tasks
        "404":
          description: Room not found
        "401":
          description: Unauthorized

  /rooms/{room_id}/stats:
    get:
      operationId: getRoomStatistics
      summary: Get room statistics
      description: Fetch aggregated task statistics for a specific room.
      tags:
        - Rooms
      parameters:
        - name: room_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Room statistics
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RoomStats"
        "404":
          description: Room not found
        "401":
          description: Unauthorized

         
  /tasks:
    get:
      operationId: getAllTasks
      summary: Get all tasks
      description: |
        Fetch a paginated list of tasks for the household with filtering and sorting.
        Includes associated room data and dependency information.
      tags:
        - Tasks
      parameters:
        - name: room_id
          in: query
          schema:
            type: string
            format: uuid
        - name: assigned_user_id
          in: query
          schema:
            type: string
            format: uuid
        - name: priority
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 5
        - name: difficulty
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 5
        - name: status
          in: query
          schema:
            type: string
            enum: [not_started, in_progress, blocked, done]
        - name: blocked
          in: query
          schema:
            type: boolean
        - name: sort
          in: query
          schema:
            type: string
            enum: [priority, difficulty, created_at]
        - name: order
          in: query
          schema:
            type: string
            enum: [asc, desc]
        - name: page
          in: query
          schema:
            type: integer
            minimum: 1
        - name: page_size
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
      responses:
        "200":
          description: Paginated task list
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PaginatedTasksResponse"
        "401":
          description: Unauthorized

    post:
      operationId: createTask
      summary: Create new task
      description: Create a new task with rooms and dependencies.
      tags:
        - Tasks
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateTaskRequest"
      responses:
        "201":
          description: Task created successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Task"
        "401":
          description: Unauthorized

  /tasks/{task_id}:
    get:
      operationId: getTask
      summary: Get single task details
      description: Fetch complete task information including rooms and dependencies.
      tags:
        - Tasks
      parameters:
        - name: task_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Task details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TaskDetails"
        "404":
          description: Task not found
        "401":
          description: Unauthorized

    put:
      operationId: updateTask
      summary: Update existing task
      description: Update any or all fields of an existing task.
      tags:
        - Tasks
      parameters:
        - name: task_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateTaskRequest"
      responses:
        "200":
          description: Task updated successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Task"
        "404":
          description: Task not found
        "401":
          description: Unauthorized

    delete:
      operationId: deleteTask
      summary: Delete task
      description: Permanently delete a task and all related records.
      tags:
        - Tasks
      parameters:
        - name: task_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "204":
          description: Task deleted
        "404":
          description: Task not found
        "401":
          description: Unauthorized

  /tasks/{task_id}/available-dependencies:
    get:
      operationId: getAvailableTaskDependencies
      summary: Get available tasks for dependencies
      description: Excludes current task and tasks that would create circular dependencies.
      tags:
        - Tasks
      parameters:
        - name: task_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Available dependency tasks
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/TaskSummary"
        "401":
          description: Unauthorized

  /tasks/{task_id}/dependencies:
    post:
      operationId: addTaskDependency
      summary: Add task dependency
      description: Add a dependency where this task depends on another task.
      tags:
        - Tasks
      parameters:
        - name: task_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AddDependencyRequest"
      responses:
        "201":
          description: Dependency added
        "400":
          description: Circular dependency detected
        "401":
          description: Unauthorized

  /tasks/{task_id}/dependencies/{depends_on_task_id}:
    delete:
      operationId: deleteTaskDependency
      summary: Remove task dependency
      tags:
        - Tasks
      parameters:
        - name: task_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: depends_on_task_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "204":
          description: Dependency removed
        "401":
          description: Unauthorized

  /tasks/{task_id}/dependency-graph:
    get:
      operationId: getTaskDependencyGraph
      summary: Get task dependency graph
      description: Fetch dependency graph data for visualization.
      tags:
        - Tasks
      parameters:
        - name: task_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Dependency graph
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TaskDependencyGraph"
        "401":
          description: Unauthorized

  /tasks/{task_id}/status:
    patch:
      operationId: updateTaskStatus
      summary: Quick update task status
      description: Mark a task as done from dashboard suggestions.
      tags:
        - Tasks
      parameters:
        - name: task_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateTaskStatusRequest"
      responses:
        "200":
          description: Task status updated
        "401":
          description: Unauthorized

  /tasks/stats:
    get:
      operationId: getDashboardStatistics
      summary: Get dashboard statistics
      description: Fetch aggregated task counts for the household.
      tags:
        - Tasks
      responses:
        "200":
          description: Task statistics
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TaskDashboardStats"
        "401":
          description: Unauthorized

  /tasks/suggestions:
    get:
      operationId: getTaskSuggestions
      summary: Get smart task suggestions
      description: Fetch top 1–3 recommended tasks with reasoning.
      tags:
        - Tasks
      responses:
        "200":
          description: Task suggestions
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/TaskSuggestion"
        "401":
          description: Unauthorized

  /users/me:
    get:
      operationId: getCurrentUser
      summary: Get current user profile
      description: Fetch authenticated user's profile information for header display.
      tags:
        - Users
      responses:
        "200":
          description: Current user profile
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserProfile"
        "401":
          description: Unauthorized

    put:
      operationId: updateCurrentUser
      summary: Update current user profile
      description: Update the authenticated user's name and email.
      tags:
        - Users
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateUserProfileRequest"
      responses:
        "200":
          description: User profile updated successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserProfile"
        "400":
          description: Invalid input
        "401":
          description: Unauthorized

  /floors:
    get:
      operationId: getFloors
      summary: Get floors
      description: Fetch list of all floors in the household for dropdown selection.
      tags:
        - Floors
      responses:
        "200":
          description: List of floors
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Floor"
        "401":
          description: Unauthorized        
    post:
      operationId: createFloor
      summary: Create floor
      description: Create a new floor within the household.
      tags:
        - Floors
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateFloorRequest"
      responses:
        "201":
          description: Floor created successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Floor"
        "400":
          description: Invalid request data
        "401":
          description: Unauthorized
        "403":
          description: Only household owner or admins can create floors
  /floors/{floor_id}:
    put:
      operationId: updateFloor
      summary: Update floor
      description: Update floor details such as its name or order.
      tags:
        - Floors
      parameters:
        - name: floor_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateFloorRequest"
      responses:
        "200":
          description: Floor updated successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Floor"
        "400":
          description: Invalid request data
        "401":
          description: Unauthorized
        "403":
          description: Only household owner or admins can update floors
        "404":
          description: Floor not found
    delete:
      operationId: deleteFloor
      summary: Delete floor
      description: Delete a floor. Rooms on this floor must be moved or deleted first.
      tags:
        - Floors
      parameters:
        - name: floor_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "204":
          description: Floor deleted successfully
        "401":
          description: Unauthorized
        "403":
          description: Only household owner or admins can delete floors
        "404":
          description: Floor not found
        "409":
          description: Floor still contains rooms        
  /invitations:
    get:
      operationId: getInvitations
      summary: Get pending invitations
      description: Fetch list of pending invitations sent from the household.
      tags:
        - Invitations
      responses:
        "200":
          description: Pending invitations
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Invitation"
        "401":
          description: Unauthorized

    post:
      operationId: inviteUser
      summary: Invite user to household
      description: Send an invitation email to join the household.
      tags:
        - Invitations
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateInvitationRequest"
      responses:
        "201":
          description: Invitation sent successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Invitation"
        "400":
          description: Invalid request
        "403":
          description: Forbidden – only household owner can invite users
        "401":
          description: Unauthorized

  /invitations/{invitation_id}:
    delete:
      operationId: cancelInvitation
      summary: Cancel invitation
      description: Cancel a pending household invitation.
      tags:
        - Invitations
      parameters:
        - name: invitation_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "204":
          description: Invitation cancelled
        "404":
          description: Invitation not found
        "403":
          description: Forbidden – only household owner can cancel invitations
        "401":
          description: Unauthorized

  /invitations/{invitation_id}/accept:
    post:
      operationId: acceptInvitation
      summary: Accept invitation to join household
      description: Accept an invitation and join the household.
      tags:
        - Invitations
      parameters:
        - name: invitation_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Invitation accepted successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Household"
        "400":
          description: Invitation already used or expired
        "404":
          description: Invitation not found
        "401":
          description: Unauthorized

  /invitations/{invitation_id}/decline:
    post:
      operationId: declineInvitation
      summary: Decline invitation to join household
      description: Decline a household invitation.
      tags:
        - Invitations
      parameters:
        - name: invitation_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "204":
          description: Invitation declined
        "400":
          description: Invitation already used or expired
        "404":
          description: Invitation not found
        "401":
          description: Unauthorized


  
components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    Household:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        createdAt:
          type: string
          format: date-time
        ownerId:
          type: string
          format: uuid
        members:
          type: array
          items:
            $ref: "#/components/schemas/HouseholdMember"
      required:
        - id
        - name
        - createdAt
        - ownerId
        - members
    HouseholdMember:
      type: object
      properties:
        userId:
          type: string
          format: uuid
        role:
          type: string
          enum:
            - owner
            - member
        joinedAt:
          type: string
          format: date-time
      required:
        - userId
        - role
        - joinedAt      
    CreateHouseholdRequest:
      type: object
      properties:
        name:
          type: string
          minLength: 1
          example: "The Smith Family"
      required:
        - name     
    UpdateHouseholdRequest:
      type: object
      properties:
        name:
          type: string
          minLength: 1
      required:
        - name
    Room:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        color:
          type: string
          description: Hex color code
          example: "#4CAF50"
        floor:
          type: string
          example: "Ground floor"
      required:
        - id
        - name
        - color

    RoomDetails:
      allOf:
        - $ref: "#/components/schemas/Room"
        - type: object
          properties:
            createdAt:
              type: string
              format: date-time
            stats:
              $ref: "#/components/schemas/RoomStats"

    CreateRoomRequest:
      type: object
      properties:
        name:
          type: string
          minLength: 1
        color:
          type: string
          example: "#2196F3"
        floor:
          type: string
      required:
        - name

    UpdateRoomRequest:
      type: object
      properties:
        name:
          type: string
        color:
          type: string
        floor:
          type: string

    RoomStats:
      type: object
      properties:
        totalTasks:
          type: integer
        completed:
          type: integer
        inProgress:
          type: integer
        blocked:
          type: integer
      required:
        - taskCount
        - totalTasks
        - completed
        - inProgress
        - blocked

    TaskSummary:
      type: object
      properties:
        id:
          type: string
          format: uuid
        title:
          type: string
        status:
          type: string
          enum: [not_started, in_progress, blocked, done]
        priority:
          type: integer
          minimum: 1
          maximum: 5
        difficulty:
          type: integer
          minimum: 1
          maximum: 5
      required:
        - id
        - title
        - status

    Task:
      type: object
      properties:
        id:
          type: string
          format: uuid
        title:
          type: string
        description:
          type: string
        priority:
          type: integer
          minimum: 1
          maximum: 5
        difficulty:
          type: integer
          minimum: 1
          maximum: 5
        status:
          type: string
          enum: [not_started, in_progress, blocked, done]
        assignedUserId:
          type: string
          format: uuid
        rooms:
          type: array
          items:
            $ref: "#/components/schemas/Room"
      required:
        - id
        - title
        - priority
        - difficulty
        - status

    TaskDetails:
      allOf:
        - $ref: "#/components/schemas/Task"
        - type: object
          properties:
            dependencies:
              type: array
              items:
                $ref: "#/components/schemas/TaskSummary"
            createdAt:
              type: string
              format: date-time
            updatedAt:
              type: string
              format: date-time
              
    CreateTaskRequest:
      type: object
      properties:
        title:
          type: string
        description:
          type: string
        priority:
          type: integer
        difficulty:
          type: integer
        assignedUserId:
          type: string
          format: uuid
        status:
          type: string
        roomIds:
          type: array
          items:
            type: string
            format: uuid
        dependencyIds:
          type: array
          items:
            type: string
            format: uuid
      required:
        - title
        - priority
        - difficulty

    UpdateTaskRequest:
      allOf:
        - $ref: "#/components/schemas/CreateTaskRequest"

    AddDependencyRequest:
      type: object
      properties:
        dependsOnTaskId:
          type: string
          format: uuid
      required:
        - dependsOnTaskId

    UpdateTaskStatusRequest:
      type: object
      properties:
        status:
          type: string
          enum: [done]
      required:
        - status

    TaskDependencyGraph:
      type: object
      properties:
        dependsOn:
          type: array
          items:
            $ref: "#/components/schemas/TaskSummary"
        dependedBy:
          type: array
          items:
            $ref: "#/components/schemas/TaskSummary"

    TaskDashboardStats:
      type: object
      properties:
        open:
          type: integer
        blocked:
          type: integer
        completed:
          type: integer

    TaskSuggestion:
      allOf:
        - $ref: "#/components/schemas/Task"
        - type: object
          properties:
            reason:
              type: string

    PaginatedTasksResponse:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: "#/components/schemas/Task"
        page:
          type: integer
        pageSize:
          type: integer
        total:
          type: integer

    UserProfile:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        email:
          type: string
          format: email
        householdId:
          type: string
          format: uuid
        role:
          type: string
          enum: [owner, member]
      required:
        - id
        - name
        - email
        - householdId
        - role

    UpdateUserProfileRequest:
      type: object
      properties:
        name:
          type: string
          minLength: 1
        email:
          type: string
          format: email

    Invitation:
      type: object
      properties:
        id:
          type: string
          format: uuid
        email:
          type: string
          format: email
        householdId:
          type: string
          format: uuid
        invitedByUserId:
          type: string
          format: uuid
        status:
          type: string
          enum: [pending, accepted, declined, cancelled, expired]
        createdAt:
          type: string
          format: date-time
        expiresAt:
          type: string
          format: date-time
      required:
        - id
        - email
        - householdId
        - status
        - createdAt

    CreateInvitationRequest:
      type: object
      properties:
        email:
          type: string
          format: email
      required:
        - email

    Floor:
      type: object
      description: Household floor representation for room grouping.
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
          example: "Ground floor"
        order:
          type: integer
          description: Sorting order for display
      required:
        - id
        - name
    CreateFloorRequest:
      type: object
      properties:
        name:
          type: string
          minLength: 1
          example: "First Floor"
        order:
          type: integer
          minimum: 0
          description: Display order of the floor within the household
          example: 0
      required:
        - name

    UpdateFloorRequest:
      type: object
      properties:
        name:
          type: string
          minLength: 1
          example: "Upstairs"
        order:
          type: integer
          minimum: 0
          description: Display order of the floor within the household
          example: 1

